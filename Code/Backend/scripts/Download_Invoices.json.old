{
  "Name": "Download_Invoices",
  "CreationDate": "2025-11-14",
  "Commands": [
    {
      "Command": "store",
      "Target": "true",
      "Value": "!errorIgnore",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "60",
      "Value": "!timeout_wait",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "60",
      "Value": "!timeout_pageLoad",
      "Description": ""
    },
    {
      "Command": "selectWindow",
      "Target": "tab=0",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "selectFrame",
      "Target": "relative=top",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "${!URL}",
      "Value": "listUrl",
      "Description": ""
    },
    {
      "Command": "storeXpathCount",
      "Target": "xpath=(//table[contains(@class,'table')]//tbody/tr[.//td[1]//a]//td[1]//a)",
      "Value": "invoiceLinkCount",
      "Description": ""
    },
    {
      "Command": "if_v2",
      "Target": "${invoiceLinkCount} == 0",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "throwError",
      "Target": "No invoice link found on this page.",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "endif",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "1",
      "Value": "i",
      "Description": ""
    },
    {
      "Command": "while_v2",
      "Target": "${i} <= ${invoiceLinkCount}",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "storeText",
      "Target": "xpath=(//table[contains(@class,'table')]//tbody/tr[.//td[1]//a]//td[1]//a)[${i}]",
      "Value": "currLinkText",
      "Description": ""
    },
    {
      "Command": "echo",
      "Target": "Clicking row ${i}/${invoiceLinkCount}: ${currLinkText}",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "waitForElementPresent",
      "Target": "xpath=(//table[contains(@class,'table')]//tbody/tr[.//td[1]//a]//td[1]//a)[${i}]",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "click",
      "Target": "xpath=(//table[contains(@class,'table')]//tbody/tr[.//td[1]//a]//td[1]//a)[${i}]",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "pause",
      "Target": "600",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "selectFrame",
      "Target": "relative=top",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "0",
      "Value": "hasAttachment",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "xpath=(//*[self::label or self::dt or self::th or self::span or self::div][contains(translate(normalize-space(.),'ATTACHMENT','attachment'),'attachment')]/following::*[self::a or self::button][contains(@href,'.pdf')])[1]",
      "Value": "attach1",
      "Description": ""
    },
    {
      "Command": "storeXpathCount",
      "Target": "${attach1}",
      "Value": "_a1",
      "Description": ""
    },
    {
      "Command": "if_v2",
      "Target": "${_a1} > 0",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "${attach1}",
      "Value": "attachmentXpath",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "1",
      "Value": "hasAttachment",
      "Description": ""
    },
    {
      "Command": "else",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "xpath=(//a[contains(@href,'.pdf')])[1]",
      "Value": "attach2",
      "Description": ""
    },
    {
      "Command": "storeXpathCount",
      "Target": "${attach2}",
      "Value": "_a2",
      "Description": ""
    },
    {
      "Command": "if_v2",
      "Target": "${_a2} > 0",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "${attach2}",
      "Value": "attachmentXpath",
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "1",
      "Value": "hasAttachment",
      "Description": ""
    },
    {
      "Command": "endif",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "endif",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "if_v2",
      "Target": "${hasAttachment} == 1",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "click",
      "Target": "${attachmentXpath}",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "pause",
      "Target": "1000",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "endif",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "open",
      "Target": "${listUrl}",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "waitForElementPresent",
      "Target": "xpath=(//table[contains(@class,'table')]//tbody/tr[.//td[1]//a]//td[1]//a)[1]",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "pause",
      "Target": "300",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return (Number(${i}) + 1);",
      "Value": "i",
      "Description": "<<< increment fix"
    },
    {
      "Command": "echo",
      "Target": "Next index -> ${i}",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "endWhile",
      "Target": "",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "echo",
      "Target": "Done. Attempted ${invoiceLinkCount} link(s).",
      "Value": "",
      "Description": ""
    }
  ]
}
